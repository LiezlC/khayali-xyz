<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Living Cosmic Primer</title>
    <style>
        body {
            font-family: 'Georgia', serif;
            background: radial-gradient(ellipse at center, #0a0a1a 0%, #000000 100%);
            color: #e0e0ff;
            margin: 0;
            padding: 0;
            overflow: hidden;
            height: 100vh;
            cursor: none;
        }
        
        .primer-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .cursor-glow {
            position: fixed;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(123, 159, 255, 0.8) 0%, transparent 70%);
            pointer-events: none;
            z-index: 1000;
            transition: all 0.1s ease;
            transform: translate(-50%, -50%);
        }
        
        .title-overlay {
            position: absolute;
            top: 20px;
            left: 0;
            right: 0;
            text-align: center;
            z-index: 100;
            pointer-events: none;
        }
        
        .title {
            font-size: 2.5em;
            color: #7b9fff;
            text-shadow: 0 0 30px rgba(123, 159, 255, 0.7);
            margin: 0;
            opacity: 0;
            animation: fadeIn 3s ease-in forwards;
        }
        
        .subtitle {
            font-size: 1.3em;
            color: #aac4ff;
            margin: 15px 0;
            font-style: italic;
            opacity: 0;
            animation: fadeIn 3s ease-in 1s forwards;
        }
        
        .controls-panel {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 100;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .control-btn {
            background: rgba(20, 40, 80, 0.7);
            color: #fff;
            border: 1px solid rgba(100, 150, 255, 0.5);
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            backdrop-filter: blur(10px);
            position: relative;
        }
        
        .control-btn:hover {
            background: rgba(100, 150, 255, 0.4);
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(100, 150, 255, 0.3);
        }
        
        .control-btn.active {
            background: rgba(100, 150, 255, 0.6);
            box-shadow: 0 0 25px rgba(100, 150, 255, 0.5);
        }
        
        .help-trigger {
            position: absolute;
            top: -5px;
            right: -5px;
            width: 20px;
            height: 20px;
            background: rgba(255, 215, 0, 0.8);
            border-radius: 50%;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .help-trigger:hover {
            background: rgba(255, 215, 0, 1);
            transform: scale(1.2);
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }
        
        .main-help-trigger {
            position: absolute;
            top: 100px;
            left: 30px;
            background: rgba(255, 215, 0, 0.9);
            color: #000;
            border: 2px solid rgba(255, 255, 255, 0.3);
            padding: 10px 15px;
            border-radius: 25px;
            cursor: pointer;
            font-family: inherit;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
            z-index: 150;
            backdrop-filter: blur(5px);
        }
        
        .main-help-trigger:hover {
            background: rgba(255, 215, 0, 1);
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.4);
        }
        
        .cosmic-scroll {
            position: fixed;
            background: linear-gradient(145deg, 
                rgba(20, 30, 60, 0.95) 0%, 
                rgba(40, 50, 90, 0.95) 50%, 
                rgba(20, 30, 60, 0.95) 100%);
            border: 2px solid rgba(255, 215, 0, 0.6);
            border-radius: 15px;
            padding: 25px;
            max-width: 400px;
            max-height: 500px;
            overflow-y: auto;
            backdrop-filter: blur(15px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5),
                        inset 0 1px 0 rgba(255, 255, 255, 0.1);
            z-index: 200;
            opacity: 0;
            transform: scale(0.8) translateY(20px);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            pointer-events: none;
        }
        
        .cosmic-scroll.visible {
            opacity: 1;
            transform: scale(1) translateY(0);
            pointer-events: all;
        }
        
        .scroll-header {
            font-size: 1.3em;
            color: #FFD700;
            margin-bottom: 15px;
            text-align: center;
            font-weight: bold;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }
        
        .scroll-content {
            color: #e0e0ff;
            line-height: 1.6;
            font-size: 1em;
        }
        
        .scroll-content h4 {
            color: #aac4ff;
            margin: 15px 0 8px 0;
            font-size: 1.1em;
        }
        
        .scroll-close {
            position: absolute;
            top: 10px;
            right: 15px;
            background: none;
            border: none;
            color: #FFD700;
            font-size: 1.5em;
            cursor: pointer;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s;
        }
        
        .scroll-close:hover {
            background: rgba(255, 215, 0, 0.2);
            transform: scale(1.1);
        }
        
        .scale-help-trigger {
            position: absolute;
            top: -8px;
            right: -8px;
            width: 24px;
            height: 24px;
            background: rgba(255, 215, 0, 0.8);
            border-radius: 50%;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: #000;
            font-weight: bold;
        }
        
        .scale-help-trigger:hover {
            background: rgba(255, 215, 0, 1);
            transform: scale(1.2);
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.5);
        }
        
        .visualization-space {
            flex: 1;
            position: relative;
            overflow: hidden;
        }
        
        .main-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        .interactive-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(10, 20, 60, 0.95));
            padding: 30px;
            z-index: 50;
            backdrop-filter: blur(5px);
        }
        
        .scale-selector {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .scale-btn {
            background: rgba(60, 90, 157, 0.3);
            color: #fff;
            border: 2px solid rgba(100, 150, 255, 0.5);
            padding: 15px 25px;
            border-radius: 30px;
            cursor: pointer;
            font-family: inherit;
            font-size: 16px;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            min-width: 140px;
        }
        
        .scale-btn:hover {
            background: rgba(100, 150, 255, 0.5);
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(100, 150, 255, 0.4);
        }
        
        .scale-btn.active {
            background: rgba(100, 150, 255, 0.7);
            box-shadow: 0 0 25px rgba(100, 150, 255, 0.6);
            transform: scale(1.1);
            border-color: rgba(255, 255, 255, 0.8);
        }
        
        .consciousness-narrative {
            text-align: center;
            font-size: 1.2em;
            line-height: 1.8;
            color: #e0e0ff;
            opacity: 0;
            transform: translateY(20px);
            transition: all 1s ease;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
        }
        
        .consciousness-narrative.visible {
            opacity: 1;
            transform: translateY(0);
        }
        
        .harmonic-dashboard {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(20, 40, 80, 0.6);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(100, 150, 255, 0.3);
            opacity: 0;
            transform: translateY(20px);
            transition: all 1s ease 0.3s;
        }
        
        .harmonic-dashboard.visible {
            opacity: 1;
            transform: translateY(0);
        }
        
        .frequency-display {
            font-family: 'Courier New', monospace;
            font-size: 1.4em;
            color: #7b9fff;
            margin-bottom: 5px;
        }
        
        .harmonic-description {
            color: #aac4ff;
            font-size: 0.9em;
            font-style: italic;
        }
        
        .waveform-display {
            width: 250px;
            height: 80px;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 8px;
            border: 1px solid rgba(100, 150, 255, 0.2);
        }
        
        @keyframes fadeIn {
            to { opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="primer-container">
        <div class="cursor-glow" id="cursor-glow"></div>
        
        <div class="title-overlay">
            <h1 class="title">The Living Cosmic Primer</h1>
            <p class="subtitle">Where consciousness and cosmos dance together</p>
        </div>
        
        <div class="controls-panel">
            <button class="control-btn active" id="audio-toggle" title="Cosmic Audio">
                üéµ
                <div class="help-trigger" data-help="audio">?</div>
            </button>
            <button class="control-btn active" id="visual-toggle" title="Harmonic Visuals">
                ‚ú®
                <div class="help-trigger" data-help="visuals">?</div>
            </button>
            <button class="control-btn" id="info-toggle" title="Consciousness Mode">
                üß†
                <div class="help-trigger" data-help="consciousness">?</div>
            </button>
        </div>
        
        <button class="main-help-trigger" id="main-help-trigger">
            üåå Cosmic Guide
        </button>
        
        <div class="visualization-space">
            <canvas id="main-canvas" class="main-canvas"></canvas>
        </div>
        
        <div class="interactive-overlay">
            <div class="scale-selector">
                <button class="scale-btn active" data-scale="solar">
                    Solar Harmonies
                    <div class="scale-help-trigger" data-help="solar">?</div>
                </button>
                <button class="scale-btn" data-scale="stellar">
                    Stellar Chorus
                    <div class="scale-help-trigger" data-help="stellar">?</div>
                </button>
                <button class="scale-btn" data-scale="galactic">
                    Galactic Symphony
                    <div class="scale-help-trigger" data-help="galactic">?</div>
                </button>
                <button class="scale-btn" data-scale="cosmic">
                    Cosmic Orchestra
                    <div class="scale-help-trigger" data-help="cosmic">?</div>
                </button>
            </div>
            
            <div class="consciousness-narrative" id="consciousness-narrative">
                Welcome to the cosmic symphony. Your awareness shapes what you perceive...
            </div>
            
            <div class="harmonic-dashboard" id="harmonic-dashboard">
                <div class="frequency-info">
                    <div class="frequency-display" id="frequency-display">256.0 Hz</div>
                    <div class="harmonic-description" id="harmonic-description">
                        Fundamental resonance of your cosmic scale
                    </div>
                </div>
                <canvas class="waveform-display" id="waveform-canvas" width="250" height="80"></canvas>
            </div>
        </div>
        
        <div class="cosmic-scroll" id="cosmic-scroll">
            <button class="scroll-close" id="scroll-close">√ó</button>
            <div class="scroll-header" id="scroll-header">Cosmic Wisdom</div>
            <div class="scroll-content" id="scroll-content">
                <!-- Content will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <script>
        class LivingCosmicPrimer {
            constructor() {
                this.canvas = document.getElementById('main-canvas');
                this.ctx = this.canvas.getContext('2d');
                this.waveformCanvas = document.getElementById('waveform-canvas');
                this.waveformCtx = this.waveformCanvas.getContext('2d');
                
                this.currentScale = 'solar';
                this.mousePos = { x: 0, y: 0 };
                this.time = 0;
                this.animationId = null;
                
                this.audioContext = null;
                this.audioEnabled = true;
                this.visualsEnabled = true;
                this.consciousnessMode = false;
                this.oscillators = new Map();
                this.masterGain = null;
                
                this.cosmicObjects = [];
                this.starField = [];
                this.helpContent = this.initializeHelpContent();
                this.currentScroll = null;
                
                this.scaleDefinitions = {
                    solar: {
                        name: 'Solar System',
                        baseFreq: 256,
                        harmonics: [1, 1.25, 1.5, 2, 2.5],
                        color: '#FFD700',
                        narrative: 'Planets dance in orbital resonance, each world adding its voice to the solar symphony.'
                    },
                    stellar: {
                        name: 'Stellar Neighborhood',
                        baseFreq: 432,
                        harmonics: [1, 1.618, 2, 2.618, 3.236],
                        color: '#4A90E2',
                        narrative: 'Stellar fusion creates pure tones that resonate across the interstellar medium.'
                    },
                    galactic: {
                        name: 'Galactic Scale',
                        baseFreq: 108,
                        harmonics: [1, 2, 4, 8, 16],
                        color: '#9932CC',
                        narrative: 'Spiral arms are frozen music, gravitational waves in spacetime itself.'
                    },
                    cosmic: {
                        name: 'Cosmic Web',
                        baseFreq: 54,
                        harmonics: [1, 3, 9, 27, 81],
                        color: '#50C878',
                        narrative: 'Galaxy clusters resonate in frequencies beyond human perception.'
                    }
                };
                
                this.init();
            }
            
            init() {
                this.setupCanvas();
                this.setupEventListeners();
                this.setupHelpSystem();
                this.generateStarField();
                this.loadScale('solar');
                this.animate();
                this.initAudioContext();
            }
            
            initializeHelpContent() {
                return {
                    main: {
                        title: "üåå Welcome to the Cosmic Symphony!",
                        content: `
                            <p>This isn't just a picture of space - it's a <strong>musical instrument</strong> that lets you play with the universe itself!</p>
                            <h4>üé≠ How to Play:</h4>
                            <ul>
                                <li><strong>Move your mouse</strong> - Conduct the cosmic symphony</li>
                                <li><strong>Click objects</strong> - Make planets and stars sing</li>
                                <li><strong>Try different scales</strong> - Each reveals new cosmic harmonies</li>
                            </ul>
                        `
                    },
                    audio: {
                        title: "üéµ Cosmic Audio Magic",
                        content: `
                            <h4>What This Button Does:</h4>
                            <p>Turns the universe's music on and off. When glowing blue, you can hear the cosmic symphony!</p>
                            <h4>üéº The Science:</h4>
                            <ul>
                                <li><strong>Planets</strong> create frequencies based on their orbital periods</li>
                                <li><strong>Stars</strong> hum with nuclear fusion harmonics</li>
                                <li><strong>Your mouse</strong> modulates these cosmic tones in real-time</li>
                            </ul>
                        `
                    },
                    visuals: {
                        title: "‚ú® Harmonic Light Show",
                        content: `
                            <h4>What This Button Does:</h4>
                            <p>Shows you the invisible sound waves spreading through space as ripples of light.</p>
                            <h4>üåä What You're Seeing:</h4>
                            <ul>
                                <li><strong>Concentric circles</strong> - Sound waves traveling through space</li>
                                <li><strong>Glowing objects</strong> - Celestial bodies resonating with your presence</li>
                            </ul>
                        `
                    },
                    consciousness: {
                        title: "üß† Consciousness Mode",
                        content: `
                            <h4>What This Button Does:</h4>
                            <p>Makes the universe extra responsive to your thoughts and movements. Objects pulse and glow more when you approach!</p>
                            <h4>üåü The Deep Magic:</h4>
                            <ul>
                                <li><strong>Observer Effect</strong> - Your attention actually changes quantum systems</li>
                                <li><strong>Consciousness Feedback</strong> - The system learns from your exploration patterns</li>
                            </ul>
                        `
                    },
                    solar: {
                        title: "üåû Solar Harmonies",
                        content: `
                            <h4>Welcome to Our Solar System!</h4>
                            <p>You're experiencing the <strong>fundamental frequencies</strong> of our cosmic neighborhood.</p>
                            <h4>üéµ What You're Hearing:</h4>
                            <ul>
                                <li><strong>Base Frequency:</strong> 256 Hz (like middle C on a piano)</li>
                                <li><strong>Planetary Harmonics:</strong> Each planet adds its own orbital frequency</li>
                            </ul>
                        `
                    },
                    stellar: {
                        title: "‚≠ê Stellar Chorus",
                        content: `
                            <h4>Journey to the Stars!</h4>
                            <p>Now you're hearing the songs of our Sun's closest neighbors across the interstellar void.</p>
                            <h4>üéµ What You're Hearing:</h4>
                            <ul>
                                <li><strong>Base Frequency:</strong> 432 Hz (the "cosmic frequency")</li>
                                <li><strong>Golden Ratio Harmonics:</strong> Mathematical perfection in sound</li>
                            </ul>
                        `
                    },
                    galactic: {
                        title: "üåå Galactic Symphony",
                        content: `
                            <h4>Behold the Milky Way!</h4>
                            <p>You're now experiencing harmonics from our entire galaxy - 400 billion stars singing together.</p>
                            <h4>üéµ What You're Hearing:</h4>
                            <ul>
                                <li><strong>Base Frequency:</strong> 108 Hz (deep bass tones)</li>
                                <li><strong>Spiral Arm Frequencies:</strong> Standing waves in the galactic structure</li>
                            </ul>
                        `
                    },
                    cosmic: {
                        title: "üå† Cosmic Orchestra",
                        content: `
                            <h4>The Ultimate Scale!</h4>
                            <p>You're now experiencing frequencies from the cosmic web itself - clusters of galaxies resonating across billions of light-years.</p>
                            <h4>üéµ What You're Hearing:</h4>
                            <ul>
                                <li><strong>Base Frequency:</strong> 54 Hz (felt more than heard)</li>
                                <li><strong>Dark Matter Resonance:</strong> The invisible scaffolding of the universe</li>
                            </ul>
                        `
                    }
                };
            }
            
            setupCanvas() {
                const resize = () => {
                    this.canvas.width = window.innerWidth;
                    this.canvas.height = window.innerHeight;
                    this.generateStarField();
                };
                resize();
                window.addEventListener('resize', resize);
            }
            
            setupEventListeners() {
                document.addEventListener('mousemove', (e) => {
                    this.mousePos.x = e.clientX;
                    this.mousePos.y = e.clientY;
                    
                    const cursorGlow = document.getElementById('cursor-glow');
                    cursorGlow.style.left = e.clientX + 'px';
                    cursorGlow.style.top = e.clientY + 'px';
                    
                    this.updateHarmonics();
                });
                
                document.querySelectorAll('.scale-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        document.querySelectorAll('.scale-btn').forEach(b => b.classList.remove('active'));
                        e.target.classList.add('active');
                        this.loadScale(e.target.dataset.scale);
                    });
                });
                
                document.getElementById('audio-toggle').addEventListener('click', () => {
                    this.toggleAudio();
                });
                
                document.getElementById('visual-toggle').addEventListener('click', () => {
                    this.toggleVisuals();
                });
                
                document.getElementById('info-toggle').addEventListener('click', () => {
                    this.toggleConsciousnessMode();
                });
                
                this.canvas.addEventListener('click', (e) => {
                    this.handleClick(e);
                });
            }
            
            setupHelpSystem() {
                document.getElementById('main-help-trigger').addEventListener('click', () => {
                    this.showHelp('main');
                });
                
                document.querySelectorAll('.help-trigger, .scale-help-trigger').forEach(trigger => {
                    trigger.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const helpType = trigger.dataset.help;
                        this.showHelp(helpType);
                    });
                });
                
                document.getElementById('scroll-close').addEventListener('click', () => {
                    this.hideHelp();
                });
                
                document.getElementById('cosmic-scroll').addEventListener('click', (e) => {
                    e.stopPropagation();
                });
                
                document.addEventListener('click', () => {
                    if (this.currentScroll) {
                        this.hideHelp();
                    }
                });
            }
            
            showHelp(type) {
                const scroll = document.getElementById('cosmic-scroll');
                const header = document.getElementById('scroll-header');
                const content = document.getElementById('scroll-content');
                
                const helpData = this.helpContent[type];
                if (!helpData) return;
                
                header.textContent = helpData.title;
                content.innerHTML = helpData.content;
                
                const trigger = document.querySelector(`[data-help="${type}"]`) || document.getElementById('main-help-trigger');
                const rect = trigger.getBoundingClientRect();
                
                scroll.style.left = Math.min(rect.left, window.innerWidth - 420) + 'px';
                scroll.style.top = Math.min(rect.bottom + 10, window.innerHeight - 520) + 'px';
                
                scroll.classList.add('visible');
                this.currentScroll = type;
            }
            
            hideHelp() {
                document.getElementById('cosmic-scroll').classList.remove('visible');
                this.currentScroll = null;
            }
            
            async initAudioContext() {
                document.addEventListener('click', async () => {
                    if (!this.audioContext) {
                        try {
                            this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                            this.masterGain = this.audioContext.createGain();
                            this.masterGain.gain.setValueAtTime(0.15, this.audioContext.currentTime);
                            this.masterGain.connect(this.audioContext.destination);
                            this.createScaleOscillators();
                        } catch (error) {
                            console.log('Audio initialization failed:', error);
                        }
                    }
                }, { once: true });
            }
            
            createScaleOscillators() {
                Object.entries(this.scaleDefinitions).forEach(([scaleName, scaleData]) => {
                    const oscillatorGroup = [];
                    
                    scaleData.harmonics.forEach((ratio, index) => {
                        const frequency = scaleData.baseFreq * ratio;
                        
                        const osc = this.audioContext.createOscillator();
                        const gain = this.audioContext.createGain();
                        
                        osc.type = index === 0 ? 'sine' : 'triangle';
                        osc.frequency.setValueAtTime(frequency, this.audioContext.currentTime);
                        
                        gain.gain.setValueAtTime(0, this.audioContext.currentTime);
                        
                        osc.connect(gain);
                        gain.connect(this.masterGain);
                        
                        osc.start();
                        
                        oscillatorGroup.push({ osc, gain, freq: frequency });
                    });
                    
                    this.oscillators.set(scaleName, oscillatorGroup);
                });
            }
            
            generateStarField() {
                this.starField = [];
                const starCount = 300;
                
                for (let i = 0; i < starCount; i++) {
                    this.starField.push({
                        x: Math.random() * this.canvas.width,
                        y: Math.random() * this.canvas.height,
                        size: Math.random() * 1.5 + 0.5,
                        opacity: Math.random() * 0.7 + 0.3,
                        twinklePhase: Math.random() * Math.PI * 2,
                        twinkleSpeed: 0.01 + Math.random() * 0.02
                    });
                }
            }
            
            loadScale(scaleName) {
                this.currentScale = scaleName;
                const scaleData = this.scaleDefinitions[scaleName];
                
                const narrative = document.getElementById('consciousness-narrative');
                narrative.classList.remove('visible');
                
                setTimeout(() => {
                    narrative.textContent = scaleData.narrative;
                    narrative.classList.add('visible');
                }, 300);
                
                this.cosmicObjects = this.createObjectsForScale(scaleName);
                this.updateHarmonicDisplay();
            }
            
            createObjectsForScale(scale) {
                const centerX = this.canvas.width / 2;
                const centerY = this.canvas.height / 2;
                const objects = [];
                
                if (scale === 'solar') {
                    objects.push({
                        x: centerX, y: centerY, radius: 20, color: '#FFD700',
                        name: 'Sun', type: 'star', harmonicFreq: 256, glow: true
                    });
                    
                    const planets = [
                        { name: 'Mercury', dist: 80, size: 3, color: '#8C7853', freq: 341 },
                        { name: 'Venus', dist: 110, size: 4, color: '#FFC649', freq: 221 },
                        { name: 'Earth', dist: 140, size: 4, color: '#6B93D6', freq: 136 },
                        { name: 'Mars', dist: 180, size: 3, color: '#CD5C5C', freq: 145 }
                    ];
                    
                    planets.forEach((planet, i) => {
                        const angle = (i / planets.length) * Math.PI * 2;
                        objects.push({
                            x: centerX + Math.cos(angle) * planet.dist,
                            y: centerY + Math.sin(angle) * planet.dist,
                            radius: planet.size, color: planet.color, name: planet.name,
                            type: 'planet', harmonicFreq: planet.freq,
                            orbitCenter: { x: centerX, y: centerY },
                            orbitRadius: planet.dist, orbitSpeed: 0.005
                        });
                    });
                } else if (scale === 'stellar') {
                    const stars = [
                        { name: 'Sun', x: 0, y: 0, size: 8, color: '#FFD700', freq: 256 },
                        { name: 'Alpha Centauri', x: -200, y: 100, size: 7, color: '#F8C471', freq: 432 },
                        { name: 'Sirius', x: 180, y: -120, size: 9, color: '#87CEEB', freq: 528 }
                    ];
                    
                    stars.forEach(star => {
                        objects.push({
                            x: centerX + star.x, y: centerY + star.y,
                            radius: star.size, color: star.color, name: star.name,
                            type: 'star', harmonicFreq: star.freq, glow: true
                        });
                    });
                } else if (scale === 'galactic') {
                    for (let arm = 0; arm < 3; arm++) {
                        const baseAngle = (arm / 3) * Math.PI * 2;
                        for (let i = 0; i < 20; i++) {
                            const t = i / 20;
                            const angle = baseAngle + t * Math.PI * 3;
                            const radius = t * 200 + 50;
                            
                            // Create proper hex colors for galactic arms
                            const hue = 240 + arm * 60; // Blue to purple to red
                            const sat = 70;
                            const light = 50 + i * 2;
                            const hexColor = this.hslToHex(hue, sat, light);
                            
                            objects.push({
                                x: centerX + Math.cos(angle) * radius,
                                y: centerY + Math.sin(angle) * radius,
                                radius: Math.max(2, 4 - t * 2),
                                color: hexColor,
                                name: `Cluster ${arm}-${i}`, type: 'cluster',
                                harmonicFreq: 108 + i * 8, glow: Math.random() > 0.7
                            });
                        }
                    }
                } else if (scale === 'cosmic') {
                    const galaxies = [
                        { name: 'Milky Way', x: 0, y: 0, size: 25, color: '#A5D6A7', freq: 54 },
                        { name: 'Andromeda', x: -180, y: -100, size: 30, color: '#81C784', freq: 81 },
                        { name: 'Triangulum', x: 200, y: 80, size: 15, color: '#4DB6AC', freq: 108 }
                    ];
                    
                    galaxies.forEach(galaxy => {
                        objects.push({
                            x: centerX + galaxy.x, y: centerY + galaxy.y,
                            radius: galaxy.size, color: galaxy.color, name: galaxy.name,
                            type: 'galaxy', harmonicFreq: galaxy.freq, glow: true
                        });
                    });
                }
                
                return objects;
            }
            
            // Helper function to convert HSL to proper hex color
            hslToHex(h, s, l) {
                l /= 100;
                const a = s * Math.min(l, 1 - l) / 100;
                const f = n => {
                    const k = (n + h / 30) % 12;
                    const color = l - a * Math.max(Math.min(k - 3, 9 - k, 1), -1);
                    return Math.round(255 * color).toString(16).padStart(2, '0');
                };
                return `#${f(0)}${f(8)}${f(4)}`;
            }
            
            updateHarmonics() {
                if (!this.audioEnabled || !this.audioContext) return;
                
                const scaleData = this.scaleDefinitions[this.currentScale];
                const oscillatorGroup = this.oscillators.get(this.currentScale);
                
                if (!oscillatorGroup) return;
                
                const centerX = this.canvas.width / 2;
                const centerY = this.canvas.height / 2;
                const distance = Math.sqrt(
                    (this.mousePos.x - centerX) ** 2 + 
                    (this.mousePos.y - centerY) ** 2
                );
                const maxDistance = Math.sqrt(centerX ** 2 + centerY ** 2);
                const intensity = Math.max(0, 1 - distance / maxDistance);
                
                oscillatorGroup.forEach((osc, index) => {
                    const volume = intensity * (0.3 / (index + 1));
                    osc.gain.gain.setTargetAtTime(volume, this.audioContext.currentTime, 0.1);
                });
                
                const currentFreq = scaleData.baseFreq * (0.8 + intensity * 0.4);
                document.getElementById('frequency-display').textContent = `${currentFreq.toFixed(1)} Hz`;
            }
            
            updateHarmonicDisplay() {
                const scaleData = this.scaleDefinitions[this.currentScale];
                document.getElementById('harmonic-description').textContent = 
                    `${scaleData.name} resonance frequencies`;
                
                const dashboard = document.getElementById('harmonic-dashboard');
                dashboard.classList.remove('visible');
                setTimeout(() => dashboard.classList.add('visible'), 300);
            }
            
            handleClick(event) {
                const rect = this.canvas.getBoundingClientRect();
                const clickX = event.clientX - rect.left;
                const clickY = event.clientY - rect.top;
                
                const clickedObject = this.cosmicObjects.find(obj => {
                    const distance = Math.sqrt((clickX - obj.x) ** 2 + (clickY - obj.y) ** 2);
                    return distance <= obj.radius + 10;
                });
                
                if (clickedObject && this.audioContext && this.audioEnabled) {
                    this.playObjectResonance(clickedObject);
                }
            }
            
            playObjectResonance(obj) {
                if (!this.audioContext) return;
                
                const freq = obj.harmonicFreq || 256;
                const harmonics = [1, 1.25, 1.5, 2];
                
                harmonics.forEach((ratio, index) => {
                    const osc = this.audioContext.createOscillator();
                    const gain = this.audioContext.createGain();
                    
                    osc.type = 'sine';
                    osc.frequency.setValueAtTime(freq * ratio, this.audioContext.currentTime);
                    
                    const volume = 0.1 / (index + 1);
                    gain.gain.setValueAtTime(0, this.audioContext.currentTime);
                    gain.gain.linearRampToValueAtTime(volume, this.audioContext.currentTime + 0.1);
                    gain.gain.exponentialRampToValueAtTime(0.001, this.audioContext.currentTime + 1.5);
                    
                    osc.connect(gain);
                    gain.connect(this.masterGain);
                    
                    osc.start();
                    osc.stop(this.audioContext.currentTime + 1.5);
                });
            }
            
            toggleAudio() {
                this.audioEnabled = !this.audioEnabled;
                document.getElementById('audio-toggle').classList.toggle('active', this.audioEnabled);
                
                if (!this.audioEnabled && this.audioContext) {
                    this.oscillators.forEach(group => {
                        group.forEach(osc => {
                            osc.gain.gain.setTargetAtTime(0, this.audioContext.currentTime, 0.1);
                        });
                    });
                }
            }
            
            toggleVisuals() {
                this.visualsEnabled = !this.visualsEnabled;
                document.getElementById('visual-toggle').classList.toggle('active', this.visualsEnabled);
            }
            
            toggleConsciousnessMode() {
                this.consciousnessMode = !this.consciousnessMode;
                document.getElementById('info-toggle').classList.toggle('active', this.consciousnessMode);
            }
            
            animate() {
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                
                if (this.visualsEnabled) {
                    this.drawStarField();
                    this.drawHarmonicFields();
                    this.updateCosmicObjects();
                    this.drawCosmicObjects();
                }
                
                this.drawWaveform();
                this.time += 0.016;
                this.animationId = requestAnimationFrame(() => this.animate());
            }
            
            drawStarField() {
                const scaleData = this.scaleDefinitions[this.currentScale];
                
                this.starField.forEach(star => {
                    const twinkle = Math.sin(this.time * star.twinkleSpeed + star.twinklePhase) * 0.3 + 0.7;
                    
                    this.ctx.globalAlpha = star.opacity * twinkle;
                    this.ctx.fillStyle = scaleData.color;
                    this.ctx.beginPath();
                    this.ctx.arc(star.x, star.y, star.size, 0, Math.PI * 2);
                    this.ctx.fill();
                });
                
                this.ctx.globalAlpha = 1;
            }
            
            drawHarmonicFields() {
                if (!this.visualsEnabled) return;
                
                const scaleData = this.scaleDefinitions[this.currentScale];
                
                this.ctx.globalAlpha = 0.15;
                
                scaleData.harmonics.forEach((ratio, index) => {
                    const frequency = scaleData.baseFreq * ratio / 20;
                    const amplitude = 30 / (index + 1);
                    
                    this.ctx.strokeStyle = scaleData.color;
                    this.ctx.lineWidth = 2 / (index + 1);
                    
                    for (let r = 20; r < 300; r += 15) {
                        const wave = Math.sin((r / frequency) + this.time * 3) * amplitude;
                        const radius = Math.max(1, r + wave);
                        
                        this.ctx.beginPath();
                        this.ctx.arc(this.mousePos.x, this.mousePos.y, radius, 0, Math.PI * 2);
                        this.ctx.stroke();
                    }
                });
                
                this.ctx.globalAlpha = 1;
            }
            
            updateCosmicObjects() {
                this.cosmicObjects.forEach(obj => {
                    if (obj.orbitCenter && obj.orbitRadius && obj.orbitSpeed) {
                        obj.angle = (obj.angle || 0) + obj.orbitSpeed;
                        obj.x = obj.orbitCenter.x + Math.cos(obj.angle) * obj.orbitRadius;
                        obj.y = obj.orbitCenter.y + Math.sin(obj.angle) * obj.orbitRadius;
                    }
                    
                    const distance = Math.sqrt(
                        (this.mousePos.x - obj.x) ** 2 + 
                        (this.mousePos.y - obj.y) ** 2
                    );
                    obj.mouseProximity = Math.max(0, 1 - distance / 200);
                });
            }
            
            drawCosmicObjects() {
                this.cosmicObjects.forEach(obj => {
                    const proximity = obj.mouseProximity || 0;
                    
                    if (obj.glow) {
                        const glowRadius = Math.max(obj.radius + 5, obj.radius * (1.5 + proximity));
                        const gradient = this.ctx.createRadialGradient(
                            obj.x, obj.y, obj.radius,
                            obj.x, obj.y, glowRadius
                        );
                        gradient.addColorStop(0, obj.color + '80');
                        gradient.addColorStop(1, obj.color + '00');
                        
                        this.ctx.fillStyle = gradient;
                        this.ctx.beginPath();
                        this.ctx.arc(obj.x, obj.y, glowRadius, 0, Math.PI * 2);
                        this.ctx.fill();
                    }
                    
                    let drawRadius = obj.radius;
                    if (proximity > 0.3) {
                        const pulse = Math.sin(this.time * 4) * 0.2 + 1;
                        drawRadius = Math.max(1, obj.radius * pulse);
                    }
                    
                    this.ctx.fillStyle = obj.color;
                    this.ctx.beginPath();
                    this.ctx.arc(obj.x, obj.y, drawRadius, 0, Math.PI * 2);
                    this.ctx.fill();
                    
                    if (obj.type === 'planet' && obj.orbitCenter && obj.orbitRadius) {
                        this.ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';
                        this.ctx.lineWidth = 1;
                        this.ctx.beginPath();
                        this.ctx.arc(obj.orbitCenter.x, obj.orbitCenter.y, obj.orbitRadius, 0, Math.PI * 2);
                        this.ctx.stroke();
                    }
                    
                    if (proximity > 0.7) {
                        this.ctx.fillStyle = 'white';
                        this.ctx.font = '14px Georgia';
                        this.ctx.textAlign = 'center';
                        this.ctx.fillText(obj.name, obj.x, obj.y - drawRadius - 10);
                    }
                });
            }
            
            drawWaveform() {
                const canvas = this.waveformCanvas;
                const ctx = this.waveformCtx;
                const scaleData = this.scaleDefinitions[this.currentScale];
                
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                ctx.strokeStyle = scaleData.color;
                ctx.lineWidth = 2;
                ctx.beginPath();
                
                for (let x = 0; x < canvas.width; x++) {
                    let y = canvas.height / 2;
                    
                    scaleData.harmonics.forEach((ratio, index) => {
                        const freq = scaleData.baseFreq * ratio;
                        const amplitude = 15 / (index + 1);
                        const phase = (x / canvas.width) * Math.PI * 4 * ratio + this.time * 2;
                        y += Math.sin(phase) * amplitude;
                    });
                    
                    if (x === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                }
                
                ctx.stroke();
                
                ctx.save();
                ctx.filter = 'blur(3px)';
                ctx.strokeStyle = scaleData.color + '60';
                ctx.lineWidth = 4;
                ctx.stroke();
                ctx.restore();
            }
        }
        
        window.addEventListener('load', () => {
            new LivingCosmicPrimer();
            
            setTimeout(() => {
                document.getElementById('consciousness-narrative').classList.add('visible');
                document.getElementById('harmonic-dashboard').classList.add('visible');
            }, 1500);
        });
    </script>
</body>
</html>