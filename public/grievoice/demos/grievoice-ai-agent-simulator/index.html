<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GrieVoice: AI Agent Simulator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --color-dark: #2C2C2C; /* Dark Grey from image bg */
            --color-teal: #008080; /* Teal from image borders/accents */
            --color-cream: #FFFDD0; /* Cream from image card bg */
            --color-accent: #4FD1C5;
        }

        body {
            background-color: var(--color-teal);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 0;
            overflow: hidden;
        }

        /* Main Container matching the card style */
        #app-container {
            background-color: var(--color-dark);
            width: 95vw;
            height: 90vh;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            display: flex;
            overflow: hidden;
            border: 4px solid var(--color-cream);
        }

        /* Left Panel: Controls & Info */
        .left-panel {
            width: 35%;
            padding: 2rem;
            color: white;
            display: flex;
            flex-direction: column;
            border-right: 2px solid #444;
        }

        /* Right Panel: The "Visual" (Cream card from image) */
        .right-panel {
            width: 65%;
            background-color: var(--color-cream);
            margin: 1rem;
            border-radius: 15px;
            position: relative;
            display: flex;
            flex-direction: column;
            padding: 1rem;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.1);
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 0.5rem;
            line-height: 1.1;
        }

        h2 {
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: var(--color-accent);
            margin-bottom: 2rem;
        }

        .stat-card {
            background: rgba(255,255,255,0.1);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .btn {
            background-color: var(--color-teal);
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: bold;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 10px;
        }

        .btn:hover {
            background-color: var(--color-accent);
            color: var(--color-dark);
            transform: translateY(-2px);
        }

        .btn-danger {
            background-color: #e53e3e;
        }
        
        .btn-secondary {
            background-color: #4a5568;
        }

        /* Chat / Log Area */
        #chat-log {
            flex-grow: 1;
            overflow-y: auto;
            margin-bottom: 1rem;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .message {
            padding: 10px 15px;
            border-radius: 10px;
            max-width: 80%;
            animation: popIn 0.3s ease-out;
            font-size: 0.9rem;
        }

        .msg-ai {
            background-color: var(--color-teal);
            color: white;
            align-self: flex-start;
            border-bottom-left-radius: 0;
        }

        .msg-user {
            background-color: #e2e8f0;
            color: #333;
            align-self: flex-end;
            border-bottom-right-radius: 0;
        }

        /* Audio Visualizer */
        .visualizer {
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            margin-bottom: 1rem;
        }

        .bar {
            width: 6px;
            background-color: var(--color-teal);
            border-radius: 3px;
            animation: wave 1s infinite ease-in-out;
        }

        @keyframes wave {
            0%, 100% { height: 10px; }
            50% { height: 40px; }
        }

        @keyframes popIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Avatar Construction using CSS */
        .avatar-container {
            width: 100px;
            height: 100px;
            margin: 0 auto 20px auto;
            position: relative;
        }
        
        .avatar-head {
            width: 60px;
            height: 70px;
            background: #fcd34d; /* Skin tone */
            border-radius: 30px;
            position: absolute;
            top: 15px;
            left: 20px;
            z-index: 2;
        }
        
        .avatar-hair {
            width: 80px;
            height: 90px;
            background: #1a202c; /* Dark hair */
            border-radius: 40px 40px 20px 20px;
            position: absolute;
            top: 5px;
            left: 10px;
            z-index: 1;
        }

        .headset {
            width: 70px;
            height: 40px;
            border: 4px solid #4FD1C5;
            border-bottom: none;
            border-radius: 40px 40px 0 0;
            position: absolute;
            top: 10px;
            left: 15px;
            z-index: 3;
        }

        .mic {
            width: 40px;
            height: 4px;
            background: #4FD1C5;
            position: absolute;
            top: 60px;
            left: 50px;
            z-index: 4;
            transform: rotate(15deg);
        }

        /* Sentiment Meter */
        .sentiment-bar-bg {
            width: 100%;
            height: 10px;
            background: #444;
            border-radius: 5px;
            overflow: hidden;
            margin-top: 5px;
        }
        .sentiment-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #e53e3e, #ecc94b, #48bb78);
            width: 50%;
            transition: width 0.5s ease;
        }

        /* Icons */
        .icon-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 20px;
        }
        
        .feature-icon {
            background: rgba(255,255,255,0.05);
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            font-size: 1.5rem;
        }

    </style>
</head>
<body>

<div id="app-container">
    <!-- Left Panel -->
    <div class="left-panel">
        <h2>Transforming Grievance Systems</h2>
        <h1>GrieVoice</h1>
        <p class="text-gray-400 mb-6">Interactive AI Voice Agent Dashboard</p>

        <div class="stat-card">
            <span>Call Status</span>
            <span id="status-badge" class="bg-red-500 text-xs px-2 py-1 rounded">OFFLINE</span>
        </div>

        <div class="stat-card">
            <div style="width:100%">
                <div class="flex justify-between text-sm mb-1">
                    <span>Customer Sentiment</span>
                    <span id="sentiment-val">50%</span>
                </div>
                <div class="sentiment-bar-bg">
                    <div id="sentiment-fill" class="sentiment-bar-fill"></div>
                </div>
            </div>
        </div>

        <div class="icon-grid">
            <div class="feature-icon" title="Transcription">üìù</div>
            <div class="feature-icon" title="Analytics">üìä</div>
            <div class="feature-icon" title="Settings">‚öôÔ∏è</div>
            <div class="feature-icon" title="Secure">üîí</div>
        </div>

        <div class="mt-auto">
            <button id="btn-start" class="btn w-full mb-2">üìû Start Simulation</button>
            <div class="flex gap-2">
                <button id="btn-undo" class="btn btn-secondary flex-1" title="Ctrl+Z">‚Ü© Undo</button>
                <button id="btn-redo" class="btn btn-secondary flex-1" title="Ctrl+Y">‚Ü™ Redo</button>
            </div>
        </div>
    </div>

    <!-- Right Panel -->
    <div class="right-panel">
        <!-- Visual Header -->
        <div class="flex items-center justify-between mb-4 border-b pb-2 border-gray-300">
            <div class="flex items-center gap-3">
                <!-- CSS Avatar -->
                <div style="width: 40px; height: 40px; position: relative;">
                    <div style="width: 100%; height: 100%; background: #2C2C2C; border-radius: 50%;"></div>
                    <div style="position: absolute; top: 10px; left: 10px; width: 20px; height: 20px; border: 2px solid #4FD1C5; border-radius: 50%;"></div>
                </div>
                <div>
                    <h3 class="font-bold text-gray-800">Agent: GV-9000</h3>
                    <p class="text-xs text-gray-500">Auto-Resolution Mode</p>
                </div>
            </div>
            <div class="text-teal-700 font-mono text-sm" id="timer">00:00</div>
        </div>

        <!-- Chat Log -->
        <div id="chat-log">
            <div class="text-center text-gray-400 text-sm mt-10">System Ready. Initiate call to begin grievance redressal.</div>
        </div>

        <!-- Interactive Area -->
        <div class="mt-auto bg-white p-4 rounded-xl border border-teal-100">
            <!-- Visualizer -->
            <div class="visualizer" id="visualizer">
                <div class="bar" style="animation-duration: 0.5s"></div>
                <div class="bar" style="animation-duration: 0.7s"></div>
                <div class="bar" style="animation-duration: 0.4s"></div>
                <div class="bar" style="animation-duration: 0.6s"></div>
                <div class="bar" style="animation-duration: 0.8s"></div>
                <div class="bar" style="animation-duration: 0.5s"></div>
                <div class="bar" style="animation-duration: 0.7s"></div>
            </div>

            <!-- Action Buttons -->
            <div id="action-buttons" class="grid grid-cols-3 gap-2 opacity-50 pointer-events-none transition-opacity">
                <button class="p-2 bg-teal-100 text-teal-800 rounded hover:bg-teal-200 text-sm font-bold" onclick="handleAction('empathy')">‚ù§Ô∏è Empathize</button>
                <button class="p-2 bg-blue-100 text-blue-800 rounded hover:bg-blue-200 text-sm font-bold" onclick="handleAction('policy')">üìú Cite Policy</button>
                <button class="p-2 bg-purple-100 text-purple-800 rounded hover:bg-purple-200 text-sm font-bold" onclick="handleAction('solve')">‚úÖ Offer Solution</button>
            </div>
        </div>
    </div>
</div>

<script>
    // --- State Management ---
    const initialState = {
        isActive: false,
        logs: [],
        sentiment: 50,
        timer: 0
    };

    let currentState = JSON.parse(JSON.stringify(initialState));
    let historyStack = [];
    let redoStack = [];
    let timerInterval = null;

    // --- DOM Elements ---
    const chatLog = document.getElementById('chat-log');
    const sentimentFill = document.getElementById('sentiment-fill');
    const sentimentVal = document.getElementById('sentiment-val');
    const statusBadge = document.getElementById('status-badge');
    const timerDisplay = document.getElementById('timer');
    const actionButtons = document.getElementById('action-buttons');
    const visualizer = document.getElementById('visualizer');

    // --- Simulation Data ---
    const customerGrievances = [
        "My order hasn't arrived yet and it's been two weeks!",
        "The product I received is damaged.",
        "I was overcharged on my last bill.",
        "Your website keeps crashing when I try to pay.",
        "I want to speak to a human manager immediately!"
    ];

    const aiResponses = {
        empathy: ["I completely understand your frustration.", "I am so sorry to hear you're experiencing this.", "That sounds incredibly annoying, let me help."],
        policy: ["According to our terms, delivery takes 5-7 days.", "Refunds are processed within 48 hours.", "Security protocols require verification first."],
        solve: ["I have expedited your shipping immediately.", "I've processed a full refund for you.", "I'm scheduling a technician visit right now."]
    };

    // --- Core Functions ---

    function saveState() {
        historyStack.push(JSON.parse(JSON.stringify(currentState)));
        if (historyStack.length > 20) historyStack.shift();
        redoStack = []; // Clear redo on new action
    }

    function render() {
        // Update Status
        if (currentState.isActive) {
            statusBadge.innerText = "ACTIVE CALL";
            statusBadge.className = "bg-green-500 text-xs px-2 py-1 rounded animate-pulse";
            actionButtons.classList.remove('opacity-50', 'pointer-events-none');
            visualizer.style.opacity = "1";
        } else {
            statusBadge.innerText = "OFFLINE";
            statusBadge.className = "bg-red-500 text-xs px-2 py-1 rounded";
            actionButtons.classList.add('opacity-50', 'pointer-events-none');
            visualizer.style.opacity = "0.2";
        }

        // Update Sentiment
        sentimentFill.style.width = `${currentState.sentiment}%`;
        sentimentVal.innerText = `${currentState.sentiment}%`;
        
        // Color code sentiment
        if (currentState.sentiment < 30) sentimentFill.style.background = "#e53e3e";
        else if (currentState.sentiment > 70) sentimentFill.style.background = "#48bb78";
        else sentimentFill.style.background = "linear-gradient(90deg, #e53e3e, #ecc94b, #48bb78)";

        // Render Logs
        chatLog.innerHTML = '';
        if (currentState.logs.length === 0) {
            chatLog.innerHTML = '<div class="text-center text-gray-400 text-sm mt-10">System Ready. Initiate call to begin grievance redressal.</div>';
        } else {
            currentState.logs.forEach(log => {
                const div = document.createElement('div');
                div.className = `message ${log.sender === 'ai' ? 'msg-ai' : 'msg-user'}`;
                div.innerText = log.text;
                chatLog.appendChild(div);
            });
            // Auto scroll to bottom
            chatLog.scrollTop = chatLog.scrollHeight;
        }

        // Update Timer
        const mins = Math.floor(currentState.timer / 60).toString().padStart(2, '0');
        const secs = (currentState.timer % 60).toString().padStart(2, '0');
        timerDisplay.innerText = `${mins}:${secs}`;
    }

    // --- Actions ---

    function startSimulation() {
        saveState();
        currentState.isActive = true;
        currentState.logs = [];
        currentState.sentiment = 40 + Math.floor(Math.random() * 20); // Random start sentiment
        currentState.timer = 0;
        
        // Initial Customer Complaint
        const randomGrievance = customerGrievances[Math.floor(Math.random() * customerGrievances.length)];
        currentState.logs.push({ sender: 'user', text: randomGrievance });
        
        startTimer();
        render();
    }

    function handleAction(type) {
        if (!currentState.isActive) return;
        saveState();

        // AI Response
        const responseOptions = aiResponses[type];
        const response = responseOptions[Math.floor(Math.random() * responseOptions.length)];
        currentState.logs.push({ sender: 'ai', text: response });

        // Calculate Sentiment Impact
        let impact = 0;
        if (type === 'empathy') impact = 10;
        if (type === 'policy') impact = -5; // Customers hate policy quoting
        if (type === 'solve') impact = 20;

        currentState.sentiment = Math.min(100, Math.max(0, currentState.sentiment + impact));

        // Random Customer Follow-up (Simulated)
        setTimeout(() => {
            if (currentState.isActive) {
                generateCustomerFollowUp(type);
            }
        }, 1000);

        render();
    }

    function generateCustomerFollowUp(lastActionType) {
        // Don't save state here to keep undo simple (undo reverts the USER interaction pair)
        // But for a robust app, we might. Here we treat the AI+Customer turn as one atomic unit visually, 
        // but logic-wise we just append.
        
        let reply = "...";
        if (currentState.sentiment > 80) {
            reply = "That sounds great, thank you!";
            setTimeout(() => endGame(true), 1500);
        } else if (currentState.sentiment < 20) {
            reply = "This is useless! I'm hanging up.";
            setTimeout(() => endGame(false), 1500);
        } else {
            if (lastActionType === 'policy') reply = "I don't care about the policy, I want a fix.";
            else if (lastActionType === 'empathy') reply = "I appreciate that, but what are you going to do?";
            else reply = "Okay, how long will that take?";
        }

        currentState.logs.push({ sender: 'user', text: reply });
        render();
    }

    function endGame(success) {
        currentState.isActive = false;
        stopTimer();
        const msg = success ? "Call Resolved Successfully ‚úÖ" : "Call Failed ‚ùå";
        currentState.logs.push({ sender: 'ai', text: `[SYSTEM]: ${msg}` });
        render();
    }

    function startTimer() {
        if (timerInterval) clearInterval(timerInterval);
        timerInterval = setInterval(() => {
            currentState.timer++;
            // Update timer in UI without full render for performance, or just call render
            const mins = Math.floor(currentState.timer / 60).toString().padStart(2, '0');
            const secs = (currentState.timer % 60).toString().padStart(2, '0');
            timerDisplay.innerText = `${mins}:${secs}`;
        }, 1000);
    }

    function stopTimer() {
        if (timerInterval) clearInterval(timerInterval);
    }

    // --- Undo / Redo Logic ---

    function performUndo() {
        if (historyStack.length === 0) return;
        redoStack.push(JSON.parse(JSON.stringify(currentState)));
        currentState = historyStack.pop();
        
        // Handle timer sync
        if (currentState.isActive) startTimer();
        else stopTimer();
        
        render();
    }

    function performRedo() {
        if (redoStack.length === 0) return;
        historyStack.push(JSON.parse(JSON.stringify(currentState)));
        currentState = redoStack.pop();
        
        if (currentState.isActive) startTimer();
        else stopTimer();

        render();
    }

    // --- Event Listeners ---

    document.getElementById('btn-start').addEventListener('click', startSimulation);
    document.getElementById('btn-undo').addEventListener('click', performUndo);
    document.getElementById('btn-redo').addEventListener('click', performRedo);

    // Keyboard Shortcuts
    document.addEventListener('keydown', (e) => {
        if ((e.metaKey || e.ctrlKey) && e.key === 'z') {
            e.preventDefault();
            performUndo();
        }
        if ((e.metaKey || e.ctrlKey) && (e.key === 'y' || (e.shiftKey && e.key === 'Z'))) {
            e.preventDefault();
            performRedo();
        }
    });

    // Mandatory Message Listener
    window.addEventListener('message', (e) => {
        if (e.data.type === 'undo') performUndo();
        if (e.data.type === 'redo') performRedo();
    });

    // Initial Render
    render();

</script>
</body>
</html>