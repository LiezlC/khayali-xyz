<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Astral Cavern: Cosmic Mindfulness</title>
    <style>
        :root {
            --primary-hue: 260;
            --secondary-hue: 320;
            --breath-duration: 6s;
            --glow-intensity: 1;
        }

        body {
            margin: 0;
            padding: 0;
            width: 100vw;
            height: 100vh;
            background-color: #020205;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
            color: white;
            user-select: none;
        }

        /* --- The Cosmic Background (The Cavern) --- */
        .scene {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            perspective: 1000px;
            overflow: hidden;
            z-index: 1;
        }

        .nebula-container {
            position: absolute;
            width: 200%;
            height: 200%;
            top: -50%;
            left: -50%;
            background: 
                radial-gradient(circle at 50% 50%, transparent 20%, #000000 120%),
                radial-gradient(circle at 30% 40%, hsla(var(--secondary-hue), 80%, 40%, 0.4), transparent 50%),
                radial-gradient(circle at 70% 60%, hsla(var(--primary-hue), 80%, 50%, 0.4), transparent 50%),
                conic-gradient(from 0deg at 50% 50%, #050510 0%, #1a0b2e 50%, #050510 100%);
            filter: blur(30px) contrast(1.2);
            animation: drift 60s infinite linear;
            z-index: 1;
        }

        .cave-walls {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at center, transparent 30%, #000 90%);
            z-index: 2;
            pointer-events: none;
        }

        /* --- The Floor (Reflective Surface) --- */
        .floor {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 40%;
            background: linear-gradient(to bottom, rgba(255,255,255,0.1), rgba(0,0,0,0.9));
            transform-origin: bottom;
            transform: perspective(500px) rotateX(60deg) scale(2);
            filter: blur(2px);
            z-index: 2;
            opacity: 0.6;
        }

        /* --- Interactive Elements --- */
        .meditator {
            position: absolute;
            bottom: 15%;
            width: 60px;
            height: 80px;
            z-index: 10;
            cursor: pointer;
            transition: transform 0.3s ease, filter 0.3s ease;
            filter: drop-shadow(0 0 10px rgba(100, 200, 255, 0.5));
        }

        .meditator:hover {
            transform: scale(1.1) translateY(-5px);
            filter: drop-shadow(0 0 20px rgba(255, 200, 100, 0.8));
        }

        .meditator svg {
            width: 100%;
            height: 100%;
            fill: #0a0a15;
            stroke: rgba(100, 200, 255, 0.5);
            stroke-width: 1;
        }

        .orb {
            position: absolute;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, #fff, hsla(var(--secondary-hue), 100%, 70%, 0.8));
            box-shadow: 0 0 calc(20px * var(--glow-intensity)) hsla(var(--secondary-hue), 100%, 50%, 0.6);
            cursor: pointer;
            z-index: 5;
            animation: floaty 4s ease-in-out infinite;
        }

        /* --- Breathing Guide (Central Portal) --- */
        .portal {
            position: absolute;
            top: 40%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: radial-gradient(circle, #fff, hsla(var(--primary-hue), 100%, 80%, 0.2) 60%, transparent 70%);
            box-shadow: 0 0 50px hsla(var(--primary-hue), 100%, 60%, 0.5);
            z-index: 3;
            animation: breathe var(--breath-duration) infinite ease-in-out;
            pointer-events: none;
        }

        /* --- UI Overlay --- */
        .ui-layer {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            max-width: 600px;
            background: rgba(10, 10, 20, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 20px;
            z-index: 100;
            display: flex;
            flex-direction: column;
            gap: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .ui-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding-bottom: 10px;
        }

        .ui-header h1 {
            font-size: 1.2rem;
            margin: 0;
            background: linear-gradient(to right, #a8c0ff, #3f2b96);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .controls {
            display: flex;
            gap: 20px;
            justify-content: space-around;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            flex: 1;
        }

        label {
            font-size: 0.8rem;
            color: #aaa;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        input[type="range"] {
            width: 100%;
            accent-color: #b19cd9;
            cursor: pointer;
        }

        .instruction {
            position: absolute;
            top: 20px;
            width: 100%;
            text-align: center;
            color: rgba(255,255,255,0.5);
            font-size: 0.9rem;
            z-index: 100;
            pointer-events: none;
            text-shadow: 0 2px 4px rgba(0,0,0,0.8);
        }

        /* --- Canvas for Particles --- */
        canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 4;
            pointer-events: none;
        }

        /* --- Animations --- */
        @keyframes drift {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes breathe {
            0%, 100% { transform: translate(-50%, -50%) scale(1); opacity: 0.5; }
            50% { transform: translate(-50%, -50%) scale(2.5); opacity: 0.9; }
        }

        @keyframes floaty {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        @keyframes appear {
            from { opacity: 0; transform: scale(0); }
            to { opacity: 1; transform: scale(1); }
        }

    </style>
</head>
<body>

    <!-- Canvas for Star Dust -->
    <canvas id="particleCanvas"></canvas>

    <!-- The Main Visual Scene -->
    <div class="scene" id="scene">
        <div class="nebula-container" id="nebula"></div>
        <div class="portal"></div>
        <div class="floor"></div>
        <div class="cave-walls"></div>
        
        <!-- Meditators will be injected here -->
        <div id="meditators-layer"></div>
        
        <!-- Floating Orbs -->
        <div class="orb" style="top: 30%; left: 70%; width: 40px; height: 40px; animation-delay: 0s;"></div>
        <div class="orb" style="top: 25%; left: 20%; width: 20px; height: 20px; animation-delay: 1s; --secondary-hue: 40;"></div>
        <div class="orb" style="top: 60%; left: 80%; width: 30px; height: 30px; animation-delay: 2s; --secondary-hue: 180;"></div>
    </div>

    <!-- Top Instruction -->
    <div class="instruction">
        Click anywhere to summon a Soul. Drag orbs to shift energy. Breathe with the light.
    </div>

    <!-- UI Controls -->
    <div class="ui-layer">
        <div class="ui-header">
            <h1>Astral Sanctuary</h1>
            <span style="font-size: 0.8rem; color: #888;">v1.0</span>
        </div>
        <div class="controls">
            <div class="control-group">
                <label>Breath Speed</label>
                <input type="range" min="2" max="10" value="6" step="0.5" id="breathSpeed">
            </div>
            <div class="control-group">
                <label>Cosmic Hue</label>
                <input type="range" min="0" max="360" value="260" id="hueShift">
            </div>
            <div class="control-group">
                <label>Intensity</label>
                <input type="range" min="0.5" max="2" value="1" step="0.1" id="intensity">
            </div>
        </div>
    </div>

    <script>
        /* --- Configuration & State --- */
        const state = {
            breathSpeed: 6,
            hue: 260,
            intensity: 1
        };

        const elements = {
            root: document.documentElement,
            scene: document.getElementById('scene'),
            meditatorsLayer: document.getElementById('meditators-layer'),
            inputs: {
                breath: document.getElementById('breathSpeed'),
                hue: document.getElementById('hueShift'),
                intensity: document.getElementById('intensity')
            }
        };

        /* --- SVG Shape for Meditator --- */
        const meditatorSVG = `
            <svg viewBox="0 0 100 120" xmlns="http://www.w3.org/2000/svg">
                <defs>
                    <linearGradient id="bodyGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:rgba(150,150,200,0.8);stop-opacity:1" />
                        <stop offset="100%" style="stop-color:rgba(20,20,40,0.9);stop-opacity:1" />
                    </linearGradient>
                </defs>
                <!-- Head -->
                <circle cx="50" cy="30" r="15" fill="url(#bodyGrad)" />
                <!-- Body/Shoulders -->
                <path d="M 20 60 Q 50 40 80 60 L 80 90 Q 90 110 70 115 L 30 115 Q 10 110 20 90 Z" fill="url(#bodyGrad)" />
                <!-- Glow Effect -->
                <circle cx="50" cy="30" r="10" fill="white" opacity="0.1" />
            </svg>
        `;

        /* --- Initialization --- */
        function init() {
            // Add initial meditators
            addMeditator(20, 70, 0.8);
            addMeditator(80, 70, 0.8);
            addMeditator(40, 65, 0.6);
            addMeditator(60, 65, 0.6);

            // Event Listeners for UI
            elements.inputs.breath.addEventListener('input', (e) => {
                state.breathSpeed = 12 - e.target.value; // Invert logic: higher val = faster breath = lower seconds
                elements.root.style.setProperty('--breath-duration', `${state.breathSpeed}s`);
            });

            elements.inputs.hue.addEventListener('input', (e) => {
                state.hue = e.target.value;
                elements.root.style.setProperty('--primary-hue', state.hue);
                elements.root.style.setProperty('--secondary-hue', (parseInt(state.hue) + 60) % 360);
            });

            elements.inputs.intensity.addEventListener('input', (e) => {
                state.intensity = e.target.value;
                elements.root.style.setProperty('--glow-intensity', state.intensity);
            });

            // Scene Interaction
            elements.scene.addEventListener('click', (e) => {
                // Don't spawn if clicking UI or existing items
                if(e.target.closest('.orb') || e.target.closest('.meditator') || e.target.closest('.ui-layer')) return;
                
                const rect = elements.scene.getBoundingClientRect();
                const x = ((e.clientX - rect.left) / rect.width) * 100;
                const y = ((e.clientY - rect.top) / rect.height) * 100;
                
                // Only spawn on the "floor" area roughly
                if(y > 50) {
                    // Scale based on depth (Y position)
                    const scale = 0.5 + ((y - 50) / 50) * 0.7;
                    addMeditator(x, y, scale);
                    createParticles(e.clientX, e.clientY, 20, 'burst');
                } else {
                    // Create a star burst in the sky
                    createParticles(e.clientX, e.clientY, 10, 'star');
                }
            });

            // Orbs interaction (Simple "Collection" mechanic)
            document.querySelectorAll('.orb').forEach(orb => {
                orb.addEventListener('click', (e) => {
                    createParticles(e.clientX, e.clientY, 30, 'collect');
                    
                    // Move orb to random location
                    orb.style.transition = "top 1s, left 1s";
                    orb.style.top = Math.random() * 60 + 10 + "%";
                    orb.style.left = Math.random() * 80 + 10 + "%";
                    
                    // Change color randomly
                    orb.style.setProperty('--secondary-hue', Math.random() * 360);
                });
            });

            // Parallax Effect
            document.addEventListener('mousemove', (e) => {
                const x = (window.innerWidth - e.pageX * 2) / 100;
                const y = (window.innerHeight - e.pageY * 2) / 100;
                
                document.getElementById('nebula').style.transform = `translate(${x}px, ${y}px) scale(1.1)`;
                
                document.querySelectorAll('.meditator').forEach(m => {
                    const depth = m.getAttribute('data-depth');
                    m.style.transform = `translate(${x * depth}px, ${y * depth}px) scale(${depth})`;
                });
            });

            animateParticles();
        }

        /* --- Logic Functions --- */
        function addMeditator(xPercent, yPercent, scale) {
            const div = document.createElement('div');
            div.className = 'meditator';
            div.innerHTML = meditatorSVG;
            div.style.left = `calc(${xPercent}% - 30px)`;
            div.style.top = `calc(${yPercent}% - 40px)`;
            div.setAttribute('data-depth', scale);
            div.style.transform = `scale(${scale})`;
            div.style.animation = "appear 1s ease-out";
            
            // Random slight float animation delay
            div.style.animationDelay = Math.random() + "s";
            
            // Click to remove (ascend)
            div.addEventListener('click', (e) => {
                e.stopPropagation();
                createParticles(e.clientX, e.clientY, 50, 'ascend');
                div.style.transition = "all 1s ease";
                div.style.opacity = "0";
                div.style.transform = `translateY(-100px) scale(${scale * 0.5})`;
                setTimeout(() => div.remove(), 1000);
            });

            elements.meditatorsLayer.appendChild(div);
        }

        /* --- Particle System --- */
        const canvas = document.getElementById('particleCanvas');
        const ctx = canvas.getContext('2d');
        let particles = [];

        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        class Particle {
            constructor(x, y, type) {
                this.x = x;
                this.y = y;
                this.type = type;
                this.life = 1.0;
                this.decay = Math.random() * 0.01 + 0.005;
                
                if (type === 'burst') {
                    this.vx = (Math.random() - 0.5) * 4;
                    this.vy = (Math.random() - 0.5) * 4;
                    this.size = Math.random() * 3 + 1;
                    this.color = `hsla(${state.hue}, 100%, 70%,`;
                } else if (type === 'ascend') {
                    this.vx = (Math.random() - 0.5) * 1;
                    this.vy = -Math.random() * 3 - 1;
                    this.size = Math.random() * 4;
                    this.color = `hsla(40, 100%, 80%,`;
                } else if (type === 'collect') {
                    this.vx = (Math.random() - 0.5) * 10;
                    this.vy = (Math.random() - 0.5) * 10;
                    this.size = Math.random() * 5;
                    this.color = `hsla(${Math.random()*360}, 100%, 90%,`;
                } else {
                    // Ambient dust
                    this.vx = (Math.random() - 0.5) * 0.5;
                    this.vy = (Math.random() - 0.5) * 0.5;
                    this.size = Math.random() * 2;
                    this.color = `hsla(220, 50%, 80%,`;
                }
            }

            update() {
                this.x += this.vx;
                this.y += this.vy;
                this.life -= this.decay;
                if(this.type === 'ascend') this.vy *= 0.98; // Slow down ascent
            }

            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fillStyle = this.color + this.life + ')';
                ctx.fill();
            }
        }

        function createParticles(x, y, count, type) {
            for(let i=0; i<count; i++) {
                particles.push(new Particle(x, y, type));
            }
        }

        // Ambient particles generator
        setInterval(() => {
            if(particles.length < 100) {
                createParticles(Math.random() * canvas.width, Math.random() * canvas.height, 1, 'ambient');
            }
        }, 100);

        function animateParticles() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            for(let i = 0; i < particles.length; i++) {
                particles[i].update();
                particles[i].draw();
                
                if(particles[i].life <= 0) {
                    particles.splice(i, 1);
                    i--;
                }
            }
            requestAnimationFrame(animateParticles);
        }

        // Run
        init();

    </script>
</body>
</html>