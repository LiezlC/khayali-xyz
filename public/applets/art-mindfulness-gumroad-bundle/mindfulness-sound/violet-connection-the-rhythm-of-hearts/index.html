<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Violet Connection: The Rhythm of Hearts</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Lato:wght@300;400&display=swap');

        :root {
            --primary-purple: #4c1d95;
            --glow-color: #d8b4fe;
            --bg-dark: #1e1b4b;
        }

        body {
            margin: 0;
            overflow: hidden;
            background: radial-gradient(circle at center bottom, #5b21b6 0%, #2e1065 40%, #000000 100%);
            font-family: 'Lato', sans-serif;
            color: white;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            user-select: none;
        }

        /* Atmospheric Fog */
        .fog-container {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 0;
            pointer-events: none;
            overflow: hidden;
        }

        .fog-layer {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 200%;
            height: 100%;
            background: url('data:image/svg+xml;utf8,%3Csvg viewBox="0 0 1000 1000" xmlns="http://www.w3.org/2000/svg"%3E%3Cfilter id="noiseFilter"%3E%3CfeTurbulence type="fractalNoise" baseFrequency="0.65" numOctaves="3" stitchTiles="stitch"/%3E%3C/filter%3E%3Crect width="100%25" height="100%25" filter="url(%23noiseFilter)" opacity="0.1"/%3E%3C/svg%3E');
            opacity: 0.3;
            animation: drift 60s linear infinite;
            mask-image: linear-gradient(to top, rgba(0,0,0,1), rgba(0,0,0,0));
        }

        @keyframes drift {
            from { transform: translateX(0); }
            to { transform: translateX(-50%); }
        }

        /* Trees Silhouette */
        .trees {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            pointer-events: none;
        }

        /* Characters */
        .stage {
            position: relative;
            width: 100%;
            max-width: 800px;
            height: 500px;
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            z-index: 10;
            padding: 0 50px;
        }

        .character {
            position: absolute;
            bottom: 0;
            width: 120px;
            height: 300px;
            transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.27), filter 0.5s ease;
            filter: drop-shadow(0 0 15px rgba(167, 139, 250, 0.3));
        }

        .char-left {
            left: 10%;
            transform: translateX(0);
        }

        .char-right {
            right: 10%;
            transform: translateX(0) scaleX(-1); /* Flip to face left */
        }

        /* CSS Drawing of Characters (Abstract Silhouettes) */
        .head {
            width: 60px;
            height: 70px;
            background: #a78bfa;
            border-radius: 50%;
            position: absolute;
            top: 0;
            left: 30px;
            box-shadow: inset -5px -5px 10px rgba(0,0,0,0.5);
        }

        .body {
            width: 100px;
            height: 220px;
            background: linear-gradient(180deg, #8b5cf6 0%, #4c1d95 100%);
            border-radius: 40px 40px 0 0;
            position: absolute;
            top: 60px;
            left: 10px;
        }

        .char-right .head {
            background: #e9d5ff; /* Slightly lighter/different tone */
        }
        .char-right .body {
            background: linear-gradient(180deg, #c084fc 0%, #581c87 100%);
            border-radius: 50px 50px 0 0; /* Softer shoulders */
        }

        /* UI Overlay */
        .ui-layer {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 50;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        .heart-container {
            position: relative;
            width: 100px;
            height: 100px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
        }

        .heart-icon {
            font-size: 4rem;
            color: #f472b6;
            filter: drop-shadow(0 0 10px #ec4899);
            transition: transform 0.1s ease;
            user-select: none;
        }

        .ring {
            position: absolute;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            width: 100%;
            height: 100%;
            animation: ripple 2s infinite linear;
            opacity: 0;
        }

        @keyframes ripple {
            0% { transform: scale(0.5); opacity: 0.8; border-color: #f472b6; }
            100% { transform: scale(1.5); opacity: 0; border-color: transparent; }
        }

        /* Dynamic Pulse Animation Class */
        .pulse-beat {
            animation: beat 0.6s infinite alternate;
        }

        @keyframes beat {
            from { transform: scale(1); }
            to { transform: scale(1.3); filter: drop-shadow(0 0 20px #ec4899); }
        }

        .status-text {
            font-family: 'Cinzel', serif;
            font-size: 1.5rem;
            text-shadow: 0 2px 4px rgba(0,0,0,0.8);
            opacity: 0.9;
            min-height: 2rem;
        }

        .progress-bar-container {
            width: 300px;
            height: 6px;
            background: rgba(255,255,255,0.1);
            border-radius: 3px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress-bar {
            width: 0%;
            height: 100%;
            background: linear-gradient(90deg, #ec4899, #8b5cf6);
            transition: width 0.3s ease-out;
            box-shadow: 0 0 10px #ec4899;
        }

        /* Particles */
        .particle {
            position: absolute;
            background: white;
            border-radius: 50%;
            pointer-events: none;
            animation: floatUp 2s ease-out forwards;
        }

        @keyframes floatUp {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(-100px) scale(0); opacity: 0; }
        }

        /* Win State */
        .win-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white;
            opacity: 0;
            pointer-events: none;
            z-index: 100;
            transition: opacity 2s ease;
        }

        .win-message {
            position: absolute;
            top: 40%;
            width: 100%;
            text-align: center;
            font-family: 'Cinzel', serif;
            font-size: 3rem;
            color: #4c1d95;
            opacity: 0;
            transform: translateY(20px);
            transition: all 2s ease 1s;
            z-index: 101;
        }

        .instruction {
            font-size: 0.9rem;
            opacity: 0.7;
            margin-top: 5px;
        }

        /* Mobile touch area */
        .touch-area {
            position: absolute;
            bottom: 20px;
            width: 100%;
            height: 200px;
            z-index: 40;
        }

    </style>
</head>
<body>

    <!-- Background Elements -->
    <div class="fog-container">
        <div class="fog-layer"></div>
    </div>

    <!-- SVG Trees Background -->
    <svg class="trees" viewBox="0 0 1000 500" preserveAspectRatio="none">
        <g stroke="none" fill="#1e1b4b" opacity="0.6">
            <!-- Left Tree -->
            <path d="M-50,500 L50,500 L40,300 C40,300 100,200 20,100 C20,100 -20,200 -10,300 Z" />
            <path d="M20,150 L60,100 L55,110 Z" />
            <!-- Right Tree -->
            <path d="M1050,500 L950,500 L960,300 C960,300 900,200 980,100 C980,100 1020,200 1010,300 Z" />
            <!-- Branches -->
            <path stroke="#4c1d95" stroke-width="2" fill="none" d="M0,0 L100,100 M50,0 L150,150 M900,50 L1000,0" />
        </g>
    </svg>

    <!-- Game Stage -->
    <div class="stage">
        <div class="character char-left" id="charLeft">
            <div class="head"></div>
            <div class="body"></div>
        </div>
        <div class="character char-right" id="charRight">
            <div class="head"></div>
            <div class="body"></div>
        </div>
    </div>

    <!-- UI / Interaction Layer -->
    <div class="ui-layer">
        <div class="status-text" id="statusText">Sync the Heartbeats</div>
        
        <div class="heart-container" id="heartBtn">
            <div class="ring"></div>
            <div class="heart-icon pulse-beat" id="heartIcon">❤️</div>
        </div>

        <div class="progress-bar-container">
            <div class="progress-bar" id="progressBar"></div>
        </div>
        
        <div class="instruction">Tap the heart when it's biggest</div>
    </div>

    <!-- Win Effects -->
    <div class="win-overlay" id="winOverlay"></div>
    <div class="win-message" id="winMessage">Connected.</div>

    <script>
        // Game State
        let score = 0;
        const maxScore = 100;
        let isBeating = false;
        let beatInterval;
        let gameActive = true;

        // DOM Elements
        const heartIcon = document.getElementById('heartIcon');
        const heartBtn = document.getElementById('heartBtn');
        const charLeft = document.getElementById('charLeft');
        const charRight = document.getElementById('charRight');
        const progressBar = document.getElementById('progressBar');
        const statusText = document.getElementById('statusText');
        const winOverlay = document.getElementById('winOverlay');
        const winMessage = document.getElementById('winMessage');

        // Audio Context (Simulated with visual rhythm for now to keep it simple/no-assets)
        // But we will use visual cues heavily.

        // Rhythm Logic
        const bpm = 60; 
        const beatDuration = 1000; // 60bpm = 1000ms
        const tolerance = 300; // ms window to click

        let lastBeatTime = 0;

        function startHeartbeat() {
            lastBeatTime = Date.now();
            
            // Visual Beat Loop
            setInterval(() => {
                if(!gameActive) return;
                const now = Date.now();
                lastBeatTime = now;
                
                // Trigger visual expansion
                heartIcon.style.transform = "scale(1.4)";
                heartIcon.style.filter = "drop-shadow(0 0 25px #ec4899)";
                
                // Reset shortly after
                setTimeout(() => {
                    if(!gameActive) return;
                    heartIcon.style.transform = "scale(1)";
                    heartIcon.style.filter = "drop-shadow(0 0 10px #ec4899)";
                }, 300);

            }, beatDuration);
        }

        function handleInteraction() {
            if (!gameActive) return;

            const now = Date.now();
            const timeSinceBeat = now - lastBeatTime;
            
            // Check if click is within tolerance window of the beat (either just happened or about to happen)
            // Simple logic: if timeSinceBeat is small (< tolerance) OR timeSinceBeat is close to next beat (> duration - tolerance)
            
            const isHit = (timeSinceBeat < tolerance) || (timeSinceBeat > (beatDuration - tolerance));

            if (isHit) {
                success();
            } else {
                fail();
            }
        }

        function success() {
            score += 10;
            if (score > maxScore) score = maxScore;
            
            updateVisuals();
            spawnParticles();
            
            statusText.innerText = getRandomPhrase(true);
            statusText.style.color = "#d8b4fe";
            
            // Pulse the characters
            charLeft.style.filter = "drop-shadow(0 0 25px rgba(167, 139, 250, 0.8))";
            charRight.style.filter = "drop-shadow(0 0 25px rgba(167, 139, 250, 0.8))";
            setTimeout(() => {
                charLeft.style.filter = "drop-shadow(0 0 15px rgba(167, 139, 250, 0.3))";
                charRight.style.filter = "drop-shadow(0 0 15px rgba(167, 139, 250, 0.3))";
            }, 200);

            if (score >= maxScore) {
                winGame();
            }
        }

        function fail() {
            score -= 5;
            if (score < 0) score = 0;
            updateVisuals();
            
            statusText.innerText = "Out of sync...";
            statusText.style.color = "#9ca3af";
            
            // Shake effect
            document.body.style.transform = "translateX(5px)";
            setTimeout(() => document.body.style.transform = "translateX(0)", 50);
        }

        function updateVisuals() {
            progressBar.style.width = `${score}%`;

            // Move characters closer based on score
            // Max movement: Left moves right by 35%, Right moves left by 35%
            const movePercent = (score / maxScore) * 35;
            
            charLeft.style.transform = `translateX(${movePercent}vw)`;
            charRight.style.transform = `translateX(-${movePercent}vw) scaleX(-1)`; // Keep right flipped
        }

        function spawnParticles() {
            for(let i=0; i<5; i++) {
                const p = document.createElement('div');
                p.classList.add('particle');
                
                // Random size
                const size = Math.random() * 8 + 4;
                p.style.width = `${size}px`;
                p.style.height = `${size}px`;
                
                // Random position around center
                const x = (window.innerWidth / 2) + (Math.random() * 200 - 100);
                const y = (window.innerHeight / 2) + (Math.random() * 100 - 50);
                
                p.style.left = `${x}px`;
                p.style.top = `${y}px`;
                
                // Color
                p.style.background = Math.random() > 0.5 ? '#f472b6' : '#a78bfa';
                
                document.body.appendChild(p);
                
                // Cleanup
                setTimeout(() => p.remove(), 2000);
            }
        }

        function getRandomPhrase(positive) {
            const phrases = [
                "Closer...",
                "Heartbeat matched.",
                "The spark grows.",
                "In rhythm.",
                "Perfect harmony."
            ];
            return phrases[Math.floor(Math.random() * phrases.length)];
        }

        function winGame() {
            gameActive = false;
            statusText.innerText = "";
            
            // Final Animation
            charLeft.style.transition = "transform 2s ease-in-out";
            charRight.style.transition = "transform 2s ease-in-out";
            
            // Make them touch
            charLeft.style.transform = `translateX(38vw)`;
            charRight.style.transform = `translateX(-38vw) scaleX(-1)`;

            setTimeout(() => {
                winOverlay.style.opacity = 1;
                winMessage.style.opacity = 1;
                winMessage.style.transform = "translateY(0)";
            }, 1500);
        }

        // Input Listeners
        heartBtn.addEventListener('mousedown', handleInteraction);
        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space') handleInteraction();
        });
        
        // Start
        startHeartbeat();

    </script>
</body>
</html>