<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lumina Grove - Interactive Soundscape</title>
    <style>
        :root {
            --bg-gradient: linear-gradient(to bottom, #1a0b2e 0%, #4a1c40 40%, #a64d79 80%, #ffb7b2 100%);
            --glow-color-1: #00ffcc;
            --glow-color-2: #ff00cc;
            --glow-color-3: #ffcc00;
            --fog-color: rgba(255, 200, 220, 0.3);
        }

        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-gradient);
            user-select: none;
        }

        /* --- Layering --- */
        #scene {
            position: relative;
            width: 100%;
            height: 100%;
            perspective: 1000px;
        }

        /* --- Background Glows (The "Nebula" effect) --- */
        .nebula {
            position: absolute;
            border-radius: 50%;
            filter: blur(60px);
            opacity: 0.6;
            animation: pulse 8s infinite alternate;
        }

        /* --- Trees (SVG Silhouettes) --- */
        .tree-layer {
            position: absolute;
            top: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 10;
        }
        
        .tree-path {
            fill: #1a0518;
        }

        /* --- The Figure --- */
        .figure {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 150px;
            height: 300px;
            z-index: 5;
            opacity: 0.9;
            filter: drop-shadow(0 0 20px rgba(255,100,100,0.3));
        }

        /* --- Interactive Lights --- */
        .light-string {
            position: absolute;
            top: 0;
            width: 2px;
            background: rgba(0,0,0,0.3);
            transform-origin: top center;
            animation: sway 3s ease-in-out infinite alternate;
            z-index: 20;
            cursor: pointer;
        }

        .bulb {
            position: absolute;
            bottom: 0;
            left: -8px; /* center on string */
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: white;
            box-shadow: 0 0 10px var(--glow-color-1), 0 0 20px var(--glow-color-1);
            transition: transform 0.1s, box-shadow 0.2s;
        }

        .bulb:active {
            transform: scale(1.2);
        }

        .bulb::after {
            content: '';
            position: absolute;
            top: -4px;
            left: 4px;
            width: 8px;
            height: 6px;
            background: #333;
        }

        /* --- Fog --- */
        .fog-layer {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 200%;
            height: 40%;
            background: linear-gradient(to top, rgba(255,255,255,0.8), transparent);
            filter: blur(20px);
            opacity: 0.4;
            z-index: 15;
            animation: drift 20s linear infinite;
            pointer-events: none;
        }

        /* --- Particles --- */
        .particle {
            position: absolute;
            background: white;
            border-radius: 50%;
            pointer-events: none;
            z-index: 25;
            opacity: 0;
        }

        /* --- UI --- */
        #ui-layer {
            position: absolute;
            bottom: 20px;
            width: 100%;
            text-align: center;
            z-index: 100;
            color: white;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }

        button {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.4);
            color: white;
            padding: 10px 20px;
            border-radius: 30px;
            cursor: pointer;
            font-size: 1rem;
            backdrop-filter: blur(5px);
            transition: background 0.3s;
            margin: 0 10px;
        }

        button:hover {
            background: rgba(255,255,255,0.3);
        }

        #start-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            color: white;
        }

        h1 {
            font-weight: 300;
            letter-spacing: 4px;
            margin-bottom: 10px;
        }

        p {
            opacity: 0.8;
            max-width: 400px;
            text-align: center;
            line-height: 1.5;
        }

        /* --- Animations --- */
        @keyframes sway {
            from { transform: rotate(-5deg); }
            to { transform: rotate(5deg); }
        }

        @keyframes pulse {
            0% { transform: scale(1); opacity: 0.4; }
            100% { transform: scale(1.2); opacity: 0.7; }
        }

        @keyframes drift {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }

        @keyframes floatUp {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(-100px) scale(0); opacity: 0; }
        }

    </style>
</head>
<body>

    <!-- Start Overlay -->
    <div id="start-overlay">
        <h1>LUMINA GROVE</h1>
        <p>An interactive soundscape inspired by the ethereal forest.</p>
        <p style="font-size: 0.9em; margin-top: 5px;">(Turn up your volume)</p>
        <br>
        <button id="start-btn">Enter the Grove</button>
    </div>

    <div id="scene">
        <!-- Background Nebulas -->
        <div class="nebula" style="top: 10%; left: 20%; width: 300px; height: 300px; background: #00ffcc;"></div>
        <div class="nebula" style="top: 40%; left: 60%; width: 400px; height: 400px; background: #ff00cc; animation-delay: -2s;"></div>
        <div class="nebula" style="top: 20%; left: 80%; width: 200px; height: 200px; background: #ffcc00; animation-delay: -4s;"></div>

        <!-- Back Fog -->
        <div class="fog-layer" style="animation-duration: 30s; opacity: 0.2;"></div>

        <!-- Trees SVG -->
        <svg class="tree-layer" viewBox="0 0 100 100" preserveAspectRatio="none">
            <!-- Left Tree -->
            <path class="tree-path" d="M0,100 C10,80 5,60 0,40 C10,45 20,30 30,35 C25,40 20,45 10,50 C20,60 15,80 0,100 Z" />
            <path class="tree-path" d="M0,0 L5,20 C15,25 35,10 45,15 C40,18 30,20 20,22 C25,35 15,40 0,50 L0,0 Z" />
            
            <!-- Right Tree -->
            <path class="tree-path" d="M100,100 C90,80 95,60 100,40 C90,45 80,30 70,35 C75,40 80,45 90,50 C80,60 85,80 100,100 Z" />
            <path class="tree-path" d="M100,0 L95,20 C85,25 65,10 55,15 C60,18 70,20 80,22 C75,35 85,40 100,50 L100,0 Z" />
            
            <!-- Top Branches -->
            <path class="tree-path" d="M0,0 C20,10 40,5 60,15 C50,10 30,5 10,0 Z" opacity="0.8"/>
            <path class="tree-path" d="M100,0 C80,10 60,5 40,15 C50,10 70,5 90,0 Z" opacity="0.8"/>
        </svg>

        <!-- The Figure (SVG) -->
        <div class="figure">
            <svg viewBox="0 0 100 200" width="100%" height="100%">
                <defs>
                    <linearGradient id="grad1" x1="0%" y1="0%" x2="0%" y2="100%">
                        <stop offset="0%" style="stop-color:rgb(50,20,50);stop-opacity:1" />
                        <stop offset="100%" style="stop-color:rgb(20,0,20);stop-opacity:0" />
                    </linearGradient>
                </defs>
                <!-- Head -->
                <circle cx="50" cy="30" r="12" fill="#2a102a" />
                <!-- Bun -->
                <circle cx="60" cy="25" r="6" fill="#2a102a" />
                <!-- Body/Dress -->
                <path d="M50,42 Q70,45 70,70 L80,180 Q50,200 20,180 L30,70 Q30,45 50,42 Z" fill="url(#grad1)" />
                <!-- Arm -->
                <path d="M45,55 Q30,70 40,90" stroke="#2a102a" stroke-width="3" fill="none" />
            </svg>
        </div>

        <!-- Lights Container (Populated by JS) -->
        <div id="lights-container"></div>

        <!-- Front Fog -->
        <div class="fog-layer"></div>

        <!-- UI -->
        <div id="ui-layer">
            <button id="auto-btn">Wind Chimes: OFF</button>
            <button id="clear-btn">Silence</button>
        </div>
    </div>

    <script>
        // --- Audio Context Setup ---
        let audioCtx;
        let masterGain;
        let reverbNode;
        let isAudioStarted = false;

        const PENTATONIC_SCALE = [
            261.63, // C4
            293.66, // D4
            329.63, // E4
            392.00, // G4
            440.00, // A4
            523.25, // C5
            587.33, // D5
            659.25, // E5
            783.99, // G5
            880.00  // A5
        ];

        const COLORS = [
            '#00ffcc', // Cyan
            '#ff00cc', // Magenta
            '#ffcc00', // Gold
            '#ff6666', // Soft Red
            '#ccff00'  // Lime
        ];

        function initAudio() {
            if (isAudioStarted) return;
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            audioCtx = new AudioContext();
            
            masterGain = audioCtx.createGain();
            masterGain.gain.value = 0.3;
            masterGain.connect(audioCtx.destination);

            // Simple Delay as Reverb
            reverbNode = audioCtx.createDelay();
            reverbNode.delayTime.value = 0.3;
            const reverbFeedback = audioCtx.createGain();
            reverbFeedback.gain.value = 0.4;
            
            reverbNode.connect(reverbFeedback);
            reverbFeedback.connect(reverbNode);
            reverbNode.connect(masterGain);

            isAudioStarted = true;
        }

        function playTone(freq, type = 'sine') {
            if (!audioCtx) return;

            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            
            osc.type = type;
            osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
            
            // Envelope
            gain.gain.setValueAtTime(0, audioCtx.currentTime);
            gain.gain.linearRampToValueAtTime(0.5, audioCtx.currentTime + 0.05); // Attack
            gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 2); // Decay

            osc.connect(gain);
            gain.connect(masterGain);
            gain.connect(reverbNode); // Send to reverb

            osc.start();
            osc.stop(audioCtx.currentTime + 2.5);
        }

        // --- Visual Logic ---

        const lightsContainer = document.getElementById('lights-container');

        function createLight(x, y, delay) {
            const stringHeight = y;
            const string = document.createElement('div');
            string.className = 'light-string';
            string.style.left = x + '%';
            string.style.height = stringHeight + 'px';
            string.style.animationDelay = delay + 's';
            
            // Randomize swing duration slightly
            string.style.animationDuration = (2 + Math.random() * 2) + 's';

            const bulb = document.createElement('div');
            bulb.className = 'bulb';
            
            // Assign random color and note
            const color = COLORS[Math.floor(Math.random() * COLORS.length)];
            const note = PENTATONIC_SCALE[Math.floor(Math.random() * PENTATONIC_SCALE.length)];
            
            bulb.style.setProperty('--glow-color-1', color);

            // Interaction
            const interact = () => {
                if (!isAudioStarted) return;
                
                // Visual Pop
                bulb.style.transform = 'scale(1.5)';
                bulb.style.boxShadow = `0 0 30px ${color}, 0 0 50px white`;
                setTimeout(() => {
                    bulb.style.transform = 'scale(1)';
                    bulb.style.boxShadow = `0 0 10px ${color}, 0 0 20px ${color}`;
                }, 200);

                // Audio
                playTone(note);

                // Particles
                createParticles(string.offsetLeft, stringHeight);
            };

            bulb.addEventListener('mousedown', interact);
            bulb.addEventListener('touchstart', (e) => { e.preventDefault(); interact(); });

            // Store interact function for auto-play
            string.interact = interact;

            string.appendChild(bulb);
            lightsContainer.appendChild(string);
            
            return string;
        }

        function createParticles(x, y) {
            for(let i=0; i<5; i++) {
                const p = document.createElement('div');
                p.className = 'particle';
                p.style.left = (x - 10 + Math.random() * 20) + 'px';
                p.style.top = (y - 10 + Math.random() * 20) + 'px';
                p.style.width = (2 + Math.random() * 4) + 'px';
                p.style.height = p.style.width;
                p.style.animation = `floatUp ${1 + Math.random()}s ease-out forwards`;
                
                document.getElementById('scene').appendChild(p);
                setTimeout(() => p.remove(), 2000);
            }
        }

        // --- Initialization ---

        const lights = [];

        function generateForest() {
            // Left side branches
            for(let i=0; i<6; i++) {
                lights.push(createLight(5 + Math.random() * 30, 50 + Math.random() * 200, Math.random() * -5));
            }
            // Right side branches
            for(let i=0; i<6; i++) {
                lights.push(createLight(65 + Math.random() * 30, 50 + Math.random() * 200, Math.random() * -5));
            }
            // Top center (distant)
            for(let i=0; i<5; i++) {
                lights.push(createLight(30 + Math.random() * 40, 20 + Math.random() * 100, Math.random() * -5));
            }
        }

        // --- UI Controls ---

        let autoPlayInterval;
        const autoBtn = document.getElementById('auto-btn');
        
        document.getElementById('start-btn').addEventListener('click', () => {
            initAudio();
            document.getElementById('start-overlay').style.opacity = 0;
            setTimeout(() => document.getElementById('start-overlay').remove(), 1000);
            generateForest();
        });

        autoBtn.addEventListener('click', () => {
            if (autoPlayInterval) {
                clearInterval(autoPlayInterval);
                autoPlayInterval = null;
                autoBtn.innerText = "Wind Chimes: OFF";
                autoBtn.style.background = "rgba(255,255,255,0.1)";
            } else {
                autoBtn.innerText = "Wind Chimes: ON";
                autoBtn.style.background = "rgba(0,255,200,0.3)";
                autoPlayInterval = setInterval(() => {
                    const randomLight = lights[Math.floor(Math.random() * lights.length)];
                    if(randomLight) randomLight.interact();
                }, 800);
            }
        });

        document.getElementById('clear-btn').addEventListener('click', () => {
            if(audioCtx) audioCtx.suspend().then(() => setTimeout(() => audioCtx.resume(), 100));
        });

    </script>
</body>
</html>